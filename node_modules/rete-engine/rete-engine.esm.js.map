{"version":3,"file":"rete-engine.esm.js","sources":["src/control-flow.ts","src/control-flow-engine.ts","src/dataflow.ts","src/utils/cache.ts","src/utils/cancellable.ts","src/dataflow-engine.ts"],"sourcesContent":["import { NodeEditor, NodeId } from 'rete'\n\nimport { ClassicScheme } from './types'\n\n/**\n * ControlFlowNodeSetup is a set of functions that define how to execute a node.\n */\nexport type ControlFlowNodeSetup<T extends ClassicScheme['Node'], I extends (keyof T['inputs'])[] = string[], O extends (keyof T['outputs'])[] = string[]> = {\n  /** Specifies the inputs which are part of the control flow */\n  inputs: () => I\n  /** Specifies the outputs which are part of the control flow */\n  outputs: () => O\n  /** Called when the node received control from the previous node */\n  execute(input: I[number], forward: (output: O[number]) => any): any\n}\n\n/**\n * ControlFlow is a class that allows to execute nodes in a graph using Control flow approach.\n * @priority 7\n */\nexport class ControlFlow<Schemes extends ClassicScheme> {\n  setups = new Map<NodeId, ControlFlowNodeSetup<any, any, any>>()\n\n  /**\n   * @param editor NodeEditor instance\n   */\n  constructor(private editor: NodeEditor<Schemes>) { }\n\n  /**\n   * Adds the node to the control flow.\n   * @param node Node instance\n   * @param setup Set of functions that define how to execute the node\n   */\n  public add<T extends Schemes['Node']>(node: T, setup: ControlFlowNodeSetup<T, (keyof T['inputs'])[], (keyof T['outputs'])[]>) {\n    const affected = this.setups.get(node.id)\n\n    if (affected) {\n      throw new Error('already processed')\n    }\n    this.setups.set(node.id, setup)\n  }\n\n  /**\n   * Removes the node from the control flow.\n   * @param nodeId Node id\n   */\n  public remove(nodeId: NodeId) {\n    this.setups.delete(nodeId)\n  }\n\n  /**\n   * Execute the node and its successors (in case `forward` is called for some output).\n   * @param nodeId Node id\n   * @param input Input key that will be considered as the initiator of the execution\n   */\n  public execute(nodeId: NodeId, input?: string) {\n    const setup = this.setups.get(nodeId)\n\n    if (!setup) throw new Error('node is not initialized')\n    const inputKeys = setup.inputs()\n\n    if (input && !inputKeys.includes(input)) throw new Error('inputs don\\'t have a key')\n\n    setup.execute(input, output => {\n      const outputKeys = setup.outputs()\n\n      if (!outputKeys.includes(output)) throw new Error('outputs don\\'t have a key')\n\n      const cons = this.editor.getConnections().filter(c => {\n        return c.source === nodeId && c.sourceOutput === output\n      })\n\n      cons.forEach(con => {\n        this.execute(con.target, con.targetInput)\n      })\n    })\n  }\n}\n","import { GetSchemes, NodeEditor, NodeId, Root, Scope } from 'rete'\n\nimport { ControlFlow } from './control-flow'\nimport { ClassicScheme } from './types'\n\nexport type ControlFlowEngineScheme = GetSchemes<\n  ClassicScheme['Node'] & { execute(input: string, forward: (output: string) => void): void },\n  ClassicScheme['Connection']\n>\n\ntype Configure<Schemes extends ControlFlowEngineScheme> = (node: Schemes['Node']) => ({\n  inputs: () => string[]\n  outputs: () => string[]\n})\n\n/**\n * ControlFlowEngine is a plugin that integrates ControlFlow with NodeEditor making it easy to use\n * @priority 9\n * @listens nodecreated\n * @listens noderemoved\n */\nexport class ControlFlowEngine<Schemes extends ControlFlowEngineScheme> extends Scope<never, [Root<Schemes>]> {\n  editor!: NodeEditor<Schemes>\n  controlflow!: ControlFlow<Schemes>\n\n  /**\n   * @param configure Allows to specify which inputs and outputs are part of the control flow\n   */\n  constructor(private configure?: Configure<Schemes>) {\n    super('control-flow-engine')\n\n    this.addPipe(context => {\n      if (context.type === 'nodecreated') {\n        this.add(context.data)\n      }\n      if (context.type === 'noderemoved') {\n        this.remove(context.data)\n      }\n      return context\n    })\n  }\n\n  setParent(scope: Scope<Root<Schemes>>): void {\n    super.setParent(scope)\n\n    this.editor = this.parentScope<NodeEditor<Schemes>>(NodeEditor)\n    this.controlflow = new ControlFlow(this.editor)\n  }\n\n  private add(node: Schemes['Node']) {\n    const options = this.configure\n      ? this.configure(node)\n      : { inputs: () => Object.keys(node.inputs), outputs: () => Object.keys(node.outputs) }\n\n    this.controlflow.add(node, {\n      inputs: options.inputs,\n      outputs: options.outputs,\n      execute: (input, forward) => {\n        node.execute(String(input), forward)\n      }\n    })\n  }\n\n  private remove(node: Schemes['Node']) {\n    this.controlflow.remove(node.id)\n  }\n\n  /**\n   * Trigger execution starting from the specified node.\n   * @param nodeId Node id\n   * @param input Input key that will be considered as the initiator of the execution\n   */\n  public execute(nodeId: NodeId, input?: string) {\n    this.controlflow.execute(nodeId, input)\n  }\n}\n","import { NodeEditor, NodeId } from 'rete'\n\nimport { ClassicScheme } from './types'\n\n/**\n * DataflowNodeSetup is a set of functions that define how to process a node.\n */\nexport type DataflowNodeSetup<\n  T extends ClassicScheme['Node'],\n  I extends { [key in keyof T['inputs']]: any },\n  O extends { [key in keyof T['outputs']]: any }\n> = {\n  inputs: () => (keyof I)[]\n  outputs: () => (keyof O)[]\n  data(fetchInputs: () => Promise<Partial<{ [key in keyof I]: I[key][] }>>): Promise<O> | O\n}\n\ntype DefaultInputs = null\ntype Inputs = Partial<Record<string, any[]>> | DefaultInputs\ntype FetchInputs<T> = T extends DefaultInputs ? Record<string, any> : Partial<T>\n\n/**\n * Dataflow is a class that allows to process nodes in a graph using Dataflow approach.\n * @priority 8\n */\nexport class Dataflow<Schemes extends ClassicScheme> {\n  setups = new Map<NodeId, DataflowNodeSetup<any, any, any>>()\n\n  /**\n   * @param editor NodeEditor instance\n   */\n  constructor(private editor: NodeEditor<Schemes>) { }\n\n  /**\n   * Adds the node to the dataflow.\n   * @param node Node instance\n   * @param setup Set of functions that define how to process the node\n   */\n  public add<T extends Schemes['Node']>(node: T, setup: DataflowNodeSetup<T, any, any>) {\n    const affected = this.setups.get(node.id)\n\n    if (affected) {\n      throw new Error('already processed')\n    }\n    this.setups.set(node.id, setup)\n  }\n\n  /**\n   * Removes the node from the dataflow.\n   * @param nodeId Node id\n   */\n  public remove(nodeId: NodeId) {\n    this.setups.delete(nodeId)\n  }\n\n  /**\n   * Fetches inputs of the node.\n   * Unlike `fetch` method, this method doesn't call `data` function of the specified node (but does call `data` for predecessor nodes recursively).\n   * @param nodeId Node id\n   * @returns Object with inputs\n   */\n  public async fetchInputs<T extends Inputs = DefaultInputs>(nodeId: NodeId): Promise<FetchInputs<T>> {\n    const result = this.setups.get(nodeId)\n\n    if (!result) throw new Error('node is not initialized')\n\n    const inputKeys = result.inputs()\n\n    const cons = this.editor.getConnections().filter(c => {\n      return c.target === nodeId && inputKeys.includes(c.targetInput)\n    })\n\n    const inputs = {} as FetchInputs<T>\n    const consWithSourceData = await Promise.all(cons.map(async c => {\n      return {\n        c,\n        sourceData: await this.fetch(c.source)\n      }\n    }))\n\n    for (const { c, sourceData } of consWithSourceData) {\n      const previous = (inputs[c.targetInput]\n        ? inputs[c.targetInput]\n        : [])!\n      const inputsMutation = inputs as Record<string, any[]>\n\n      inputsMutation[c.targetInput] = [...previous, sourceData[c.sourceOutput]]\n    }\n\n    return inputs\n  }\n\n  /**\n   * Fetches outputs of the node.\n   * This method recursively calls `data` function of the predecessor nodes until receives all of the required inputs and calls `data` function of the specified node.\n   * @param nodeId Node id\n   * @returns Object with outputs\n   */\n  public async fetch<T extends Record<string, any>>(nodeId: NodeId): Promise<T> {\n    const result = this.setups.get(nodeId)\n\n    if (!result) throw new Error('node is not initialized')\n\n    const outputKeys = result.outputs()\n    const data = await result.data(() => this.fetchInputs(nodeId))\n\n    const returningKeys = Object.keys(data) as (string | number | symbol)[]\n\n    if (!outputKeys.every(key => returningKeys.includes(key))) {\n      throw new Error(`dataflow node \"${nodeId}\" doesn't return all of required properties. Expected \"${outputKeys.join('\", \"')}\". Got \"${returningKeys.join('\", \"')}\"`)\n    }\n\n    return data\n  }\n}\n","export class Cache<Key, T> {\n  cache = new Map<Key, T>()\n\n  constructor(private onDelete?: (item?: T) => void) {}\n\n  get(key: Key) {\n    return this.cache.get(key)\n  }\n\n  add(key: Key, data: T) {\n    if (this.cache.has(key)) throw new Error('cache already exists')\n\n    this.cache.set(key, data)\n  }\n\n  patch(key: Key, data: T) {\n    this.cache.set(key, data)\n  }\n\n  delete(key: Key) {\n    const item = this.cache.get(key)\n\n    this.cache.delete(key)\n    if (this.onDelete) {\n      this.onDelete(item)\n    }\n  }\n\n  clear() {\n    Array.from(this.cache.keys()).forEach(item => {\n      this.delete(item)\n    })\n  }\n}\n","/**\n * Cancelled exception. Thrown when `reset` is called while fetching data.\n */\nexport class Cancelled extends Error {\n  constructor() {\n    super('cancelled')\n  }\n}\n\nexport type Cancellable<T> = Promise<T> & { cancel?: () => void }\ntype S<A, B> = (data: A) => B | PromiseLike<B>\n\nfunction createCancellblePromise<A, B>(...sequence: [S<void, A>, S<A, B>]): Cancellable<B>\nfunction createCancellblePromise<A, B, C>(...sequence: [S<void, A>, S<A, B>, S<B, C>]): Cancellable<C>\nfunction createCancellblePromise(...sequence: S<any, any>[]): Cancellable<any> {\n  let cancelled = false\n\n  function commit<R>(value: R): R {\n    if (cancelled) {\n      throw new Cancelled()\n    }\n    return value\n  }\n\n  // eslint-disable-next-line init-declarations\n  let reject: (reason?: any) => void\n\n  const promise: Cancellable<void> = new Promise<void>((res, rej) => {\n    reject = rej\n    res()\n  })\n\n  const n = sequence.reduce((p, item) => {\n    const t = p.then(item as any).then(commit)\n\n    return t\n  }, promise) as Cancellable<any>\n\n  n.cancel = () => {\n    if (!cancelled) reject(new Cancelled())\n    cancelled = true\n  }\n\n  return n\n}\n\nexport {\n  createCancellblePromise\n}\n","import { GetSchemes, NodeEditor, NodeId, Root, Scope } from 'rete'\n\nimport { Dataflow } from './dataflow'\nimport { ClassicScheme } from './types'\nimport { Cache } from './utils/cache'\nimport { Cancellable, createCancellblePromise } from './utils/cancellable'\n\nexport type DataflowNode = { data(inputs: Record<string, any>): Promise<Record<string, any>> | Record<string, any> }\ntype Node = ClassicScheme['Node'] & DataflowNode\nexport type DataflowEngineScheme = GetSchemes<\n  Node,\n  ClassicScheme['Connection']\n>\n\ntype Configure<Schemes extends DataflowEngineScheme> = (node: Schemes['Node']) => ({\n  inputs: () => string[]\n  outputs: () => string[]\n})\n\n/**\n * DataflowEngine is a plugin that integrates Dataflow with NodeEditor making it easy to use.\n * Additionally, it provides a cache for the data of each node in order to avoid recurring calculations.\n * @priority 10\n * @listens nodecreated\n * @listens noderemoved\n */\nexport class DataflowEngine<Schemes extends DataflowEngineScheme> extends Scope<never, [Root<Schemes>]> {\n  editor!: NodeEditor<Schemes>\n  dataflow?: Dataflow<Schemes>\n  cache = new Cache<NodeId, Cancellable<Record<string, any>>>(data => data?.cancel && data.cancel())\n\n  constructor(private configure?: Configure<Schemes>) {\n    super('dataflow-engine')\n\n    this.addPipe(context => {\n      if (context.type === 'nodecreated') {\n        this.add(context.data)\n      }\n      if (context.type === 'noderemoved') {\n        this.remove(context.data)\n      }\n      return context\n    })\n  }\n\n  setParent(scope: Scope<Root<Schemes>>): void {\n    super.setParent(scope)\n\n    this.editor = this.parentScope<NodeEditor<Schemes>>(NodeEditor)\n    this.dataflow = new Dataflow(this.editor)\n  }\n\n  private getDataflow() {\n    if (!this.dataflow) throw new Error(`DataflowEngine isn't attached to NodeEditor`)\n    return this.dataflow\n  }\n\n  private add(node: Schemes['Node']) {\n    const options = this.configure\n      ? this.configure(node)\n      : { inputs: () => Object.keys(node.inputs), outputs: () => Object.keys(node.outputs) }\n\n    this.getDataflow().add(node, {\n      inputs: options.inputs,\n      outputs: options.outputs,\n      data: async fetchInputs => {\n        const cache = this.cache.get(node.id)\n\n        if (cache) return cache\n\n        const cancellable = createCancellblePromise(\n          () => fetchInputs(),\n          inputs => node.data(inputs)\n        )\n\n        this.cache.add(node.id, cancellable)\n\n        return cancellable\n      }\n    })\n  }\n\n  private remove(node: Schemes['Node']) {\n    this.getDataflow().remove(node.id)\n  }\n\n  /**\n   * Resets the cache of the node and all its predecessors.\n   * @param nodeId Node id to reset. If not specified, all nodes will be reset.\n   */\n  public reset(nodeId?: NodeId) {\n    if (nodeId) {\n      const setup = this.getDataflow().setups.get(nodeId)\n\n      if (!setup) throw new Error('setup')\n\n      const outputKeys = setup.outputs()\n\n      this.cache.delete(nodeId)\n      this.editor.getConnections()\n        .filter(c => c.source === nodeId && outputKeys.includes(c.sourceOutput))\n        .forEach(c => {\n          this.reset(c.target)\n        })\n    } else {\n      this.cache.clear()\n    }\n  }\n\n  /**\n   * Fetches input data for the node by fetching data for all its predecessors recursively.\n   * @param nodeId Node id to fetch input data for\n   * @throws `Cancelled when `reset` is called while fetching data\n   */\n  public async fetchInputs<N extends Node>(node: NodeId | N): Promise<Parameters<N['data']>[0]> {\n    const id = typeof node === 'object'\n      ? node.id\n      : node\n\n    return this.getDataflow().fetchInputs<Parameters<N['data']>[0]>(id)\n  }\n\n  /**\n   * Fetches output data of the node\n   * @param nodeId Node id to fetch data from\n   * @throws `Cancelled` when `reset` is called while fetching data\n   */\n  public async fetch<N extends Node>(node: NodeId | N): Promise<ReturnType<N['data']>> {\n    const id = typeof node === 'object'\n      ? node.id\n      : node\n\n    return this.getDataflow().fetch<ReturnType<N['data']>>(id)\n  }\n}\n"],"names":["ControlFlow","editor","_classCallCheck","_defineProperty","Map","_createClass","key","value","add","node","setup","affected","setups","get","id","Error","set","remove","nodeId","execute","input","_this","inputKeys","inputs","includes","output","outputKeys","outputs","cons","getConnections","filter","c","source","sourceOutput","forEach","con","target","targetInput","ControlFlowEngine","_Scope","configure","_callSuper","addPipe","context","type","data","_inherits","setParent","scope","_superPropGet","parentScope","NodeEditor","controlflow","options","Object","keys","forward","String","Scope","Dataflow","_fetchInputs","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","result","consWithSourceData","_iterator","_step","_step$value","sourceData","previous","inputsMutation","wrap","_callee2$","_context2","prev","next","Promise","all","map","_ref","_callee","_callee$","_context","t0","fetch","t1","sent","abrupt","stop","_x2","apply","arguments","_createForOfIteratorHelper","s","n","done","concat","_toConsumableArray","err","e","f","fetchInputs","_x","_fetch","_callee3","_this2","returningKeys","_callee3$","_context3","every","join","_x3","Cache","onDelete","cache","has","patch","delete","item","clear","Array","from","Cancelled","_Error","_wrapNativeSuper","createCancellblePromise","cancelled","commit","reject","promise","res","rej","_len","length","sequence","_key","reduce","p","t","then","cancel","DataflowEngine","dataflow","getDataflow","_data","cancellable","reset","_this3","_typeof"],"mappings":"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"}